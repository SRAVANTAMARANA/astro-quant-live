<!DOCTYPE html>
<html>
<head>
  <title>ICT Chart Panel</title>
  <meta charset="utf-8"/>
  <style>
    body { font-family: Arial; margin: 20px; }
    #chart { height: 500px; }
    .panel { margin-top: 20px; }
    button { margin: 5px; padding: 10px; }
  </style>
</head>
<body>
  <h1>AstroQuant ICT Chart Panel</h1>
  
  <!-- TradingView Widget -->
  <div id="chart"></div>
  <script src="https://s3.tradingview.com/tv.js"></script>
  <script>
    new TradingView.widget({
      "container_id": "chart",
      "symbol": "OANDA:XAUUSD",
      "interval": "5",
      "timezone": "Etc/UTC",
      "theme": "light",
      "style": "1",
      "locale": "en",
      "enable_publishing": false,
      "hide_top_toolbar": false,
      "hide_legend": false,
      "save_image": false
    });
  </script>

  <!-- ICT Controls -->
  <div class="panel">
    <h3>ICT Tools</h3>
    <button onclick="checkFVG()">Detect FVG</button>
    <button onclick="checkTurtleSoup()">Detect Turtle Soup</button>
  </div>

  <pre id="output"></pre>

  <script>
    async function checkFVG() {
      const res = await fetch("/ict/fvg", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({candles: sampleData})
      });
      document.getElementById("output").textContent = JSON.stringify(await res.json(), null, 2);
    }

    async function checkTurtleSoup() {
      const res = await fetch("/ict/turtle_soup", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({candles: sampleData})
      });
      document.getElementById("output").textContent = JSON.stringify(await res.json(), null, 2);
    }

    // --- Sample Candles for Testing ---
    const sampleData = [
      {"time":"2025-09-19T09:30","open":3400,"high":3410,"low":3395,"close":3405},
      {"time":"2025-09-19T09:35","open":3405,"high":3415,"low":3400,"close":3410},
      {"time":"2025-09-19T09:40","open":3410,"high":3420,"low":3408,"close":3415},
      {"time":"2025-09-19T09:45","open":3415,"high":3425,"low":3405,"close":3410}
    ];
  </script>
</body>
</html>
